<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Absensi Dinamis</title>
  <style>
    table, th, td { border: 1px solid black; border-collapse: collapse; padding: 5px; }
    th { background-color: #f0f0f0; }
  </style>
</head>
<body>
  <h2>Form Absensi Kelas</h2>
  <label>Tanggal: <input type="date" id="tanggal" required></label><br><br>
  <label>Kelas:
    <input type="text" id="kelas" placeholder="Contoh: 7A" required>
    <button onclick="loadSiswa()">Muat Siswa</button>
  </label><br><br>

  <form id="absenForm" style="display:none;">
    <table>
      <thead>
        <tr>
          <th>No</th>
          <th>Nama</th>
          <th>M</th><th>I</th><th>S</th><th>A</th>
        </tr>
      </thead>
      <tbody id="absenTableBody"></tbody>
    </table><br>
    <button type="submit">Kirim Absensi</button>
  </form>

  <script>
    let siswaList = [];

    async function loadSiswa() {
      const kelas = document.getElementById("kelas").value;
      const response = await fetch(`https://script.google.com/macros/s/AKfycbxXn-VYv9T_c-omJv8LZAYggNKn84eweH7oPNIsa5Gu8njwYaABpMDUMPdo99QKOm1o/exec?kelas=${kelas}`);
      siswaList = await response.json();

      const tbody = document.getElementById("absenTableBody");
      tbody.innerHTML = "";
      siswaList.forEach((siswa, index) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${siswa.no}</td>
          <td>${siswa.nama}</td>
          <td><input type="radio" name="status-${index}" value="M" required></td>
          <td><input type="radio" name="status-${index}" value="I"></td>
          <td><input type="radio" name="status-${index}" value="S"></td>
          <td><input type="radio" name="status-${index}" value="A"></td>
        `;
        tbody.appendChild(tr);
      });

      document.getElementById("absenForm").style.display = "block";
    }

    document.getElementById("absenForm").addEventListener("submit", function(e) {
      e.preventDefault();
      const tanggal = document.getElementById("tanggal").value;
      const kelas = document.getElementById("kelas").value;

      const absensi = siswaList.map((siswa, index) => {
        const status = document.querySelector(`input[name="status-${index}"]:checked`)?.value || "";
        return {
          no: siswa.no,
          nama: siswa.nama,
          status
        };
      });

      fetch("https://script.google.com/macros/s/AKfycbxXn-VYv9T_c-omJv8LZAYggNKn84eweH7oPNIsa5Gu8njwYaABpMDUMPdo99QKOm1o/exec", {
        method: "POST",
        body: JSON.stringify({ tanggal, kelas, absensi }),
        headers: { "Content-Type": "application/json" }
      }).then(res => res.text()).then(response => {
        alert("Absensi berhasil dikirim!");
      });
    });
  </script>
</body>
</html>
